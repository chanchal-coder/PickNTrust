import{u as x,j as e}from"./query-COiO4MCT.js";import{r as n}from"./vendor-1XCZ5AD1.js";import{G as $,u as E,U as S,H as h,F as f,A as T,W as B,c as I,I as L,g as _,e as q}from"./pages-main-DHSVTjK5.js";import{P as U}from"./pages-picks-myehRy1v.js";import"./radix-mRa0f3kV.js";import"./icons-CGpN3lH8.js";import"./utils-Bj7X0qp-.js";function V(){const{slug:s}=$(),{toast:l}=E(),[c,j]=n.useState(""),[u,p]=n.useState({min:0,max:1/0}),[N,b]=n.useState(0),{data:t,isLoading:v,error:d}=x({queryKey:[`/api/nav-tabs/${s}`],queryFn:async()=>{let a;try{a=await fetch("/api/nav-tabs",{method:"GET",headers:{"Content-Type":"application/json"},mode:"cors"})}catch{console.log("Direct call failed, trying proxy..."),a=await fetch("/api/nav-tabs")}if(!a.ok)throw new Error("Failed to fetch navigation tabs");const g=(await a.json()).find(m=>m.slug===s&&m.is_active);if(!g)throw new Error("Navigation tab not found");return g},staleTime:0,refetchOnWindowFocus:!1,refetchInterval:!1}),{data:o=[],isLoading:w,error:y}=x({queryKey:[`/api/products/page/${s}`],queryFn:async()=>{const a=await fetch(`/api/products/page/${s}`);if(!a.ok){if(a.status===404)return[];throw new Error("Failed to fetch products")}return a.json()},enabled:!!s,staleTime:0}),{data:k=[]}=x({queryKey:[`/api/categories/page/${s}`],queryFn:async()=>{const a=await fetch(`/api/categories/page/${s}`);if(!a.ok){if(a.status===404)return[];throw new Error("Failed to fetch categories")}return a.json()},enabled:!!s,staleTime:0}),i=o.filter(a=>{if(c&&a.category!==c&&a.subcategory!==c)return!1;const r=parseFloat(String(a.price));return!(r<u.min||r>u.max||parseFloat(String(a.rating||"0"))<N)}),P=a=>{j(a)},C=(a,r)=>{p({min:a,max:r})},F=a=>{b(a)};if(n.useEffect(()=>{d&&l({title:"Page not found",description:"This navigation page does not exist or is not active.",variant:"destructive"})},[d,l]),n.useEffect(()=>{y&&l({title:"Error loading products",description:`Failed to load products for ${(t==null?void 0:t.name)||s}. Please try again.`,variant:"destructive"})},[y,l,t==null?void 0:t.name,s]),v)return e.jsx(S,{pageId:"dynamicpage",children:e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 page-container",children:[e.jsx(h,{}),e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2",children:"Loading page..."}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500",children:"Please wait while we load the page content."})]})}),e.jsx(f,{})]})});if(d||!t)return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 page-container",children:[e.jsx(h,{}),e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:e.jsx("i",{className:"fas fa-exclamation-triangle text-red-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2",children:"Page Not Found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500",children:"The page you're looking for doesn't exist or is not active."})]})}),e.jsx(f,{})]});const R={background:`linear-gradient(to right, ${t.color_from}, ${t.color_to})`};return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 page-container",children:[e.jsx(h,{}),e.jsx(T,{}),e.jsx(B,{}),e.jsxs("div",{className:"header-spacing",children:[e.jsx("div",{className:"py-8",style:R,children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-4",children:[e.jsx("i",{className:`${t.icon} mr-3`}),t.name]}),e.jsx("p",{className:"text-lg text-white/90 max-w-2xl mx-auto",children:t.description||`Discover amazing products in ${t.name}`}),e.jsx("div",{className:"mt-4",children:e.jsxs("span",{className:"inline-flex items-center px-4 py-2 bg-white/20 text-white rounded-full text-sm",children:[e.jsx("i",{className:"fas fa-box mr-2"}),i.length," Products Available"]})})]})})}),e.jsxs("div",{className:"flex min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx(I,{onCategoryChange:P,onPriceRangeChange:C,onRatingChange:F,availableCategories:k}),e.jsxs("div",{className:"flex-1 p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Results (",i.length,")"]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",i.length," of ",o.length," products"]})]})}),w?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsxs("h3",{className:"text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2",children:["Loading ",t.name,"..."]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500",children:"Finding the best products for you."})]}):i.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"text-6xl mb-4",children:e.jsx("i",{className:"fas fa-search text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2",children:o.length===0?`No ${t.name} available`:"No products found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500",children:o.length===0?`Products will appear here when added to ${t.name} via admin panel.`:"Try adjusting your filters to see more results."})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:i.map(a=>a.totalInGroup&&Number(a.totalInGroup)>1?e.jsx(L,{product:a,source:s||"dynamic"},a.id):e.jsx(_,{product:{id:a.id,name:a.name,description:a.description||"",price:a.price,originalPrice:a.originalPrice,currency:a.currency||"INR",imageUrl:a.imageUrl||a.image_url,affiliateUrl:a.affiliateUrl||a.affiliate_url,category:a.category,rating:a.rating,reviewCount:a.reviewCount,discount:a.discount,isNew:a.isNew,isFeatured:a.isFeatured,affiliate_network:a.affiliate_network||a.networkBadge,networkBadge:a.networkBadge,affiliateNetwork:a.affiliateNetworkName||"Dynamic Network",sourceType:s||"dynamic",source:s||"dynamic",displayPages:[s||"dynamic"]}},a.id))})]})]}),t&&e.jsx(U,{page:t.slug,title:`${t.name} Videos`})]}),e.jsx(f,{}),e.jsx(q,{})]})}export{V as default};
