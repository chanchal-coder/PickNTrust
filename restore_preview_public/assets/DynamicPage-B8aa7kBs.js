import{r as o,j as e}from"./vendor-DNlhI76F.js";import{u as P}from"./query-D71mr71Q.js";import{J as V,u as J,b as Q,i as D,U as X,H as C,F,W as l,A as Y,B as Z,d as M,e as R,V as ee,l as se,j as ae}from"./pages-main-DOjN59On.js";import{u as te,S as ie,a as ne,b as re,c as le,P as oe}from"./pages-picks-B8mK09nr.js";import"./icons-B2XESxUM.js";import"./utils-Bj7X0qp-.js";import"./radix-z-2eheXi.js";function Ne(){const{slug:r}=V(),{toast:f}=J(),[h,u]=o.useState(""),[ce,de]=o.useState({min:0,max:1/0}),[w,N]=o.useState(0),[W,$]=o.useState(!1),[c,p]=o.useState("all"),[z]=Q(),[v,y]=o.useState("all"),[L,j]=o.useState(!1),[k,b]=o.useState("all"),{data:a,isLoading:H,error:S}=P({queryKey:[`/api/nav-tabs/${r}`],queryFn:async()=>{let s;try{s=await fetch("/api/nav-tabs",{method:"GET",headers:{"Content-Type":"application/json"},mode:"cors"})}catch{console.log("Direct call failed, trying proxy..."),s=await fetch("/api/nav-tabs")}if(!s.ok)throw new Error("Failed to fetch navigation tabs");const i=(await s.json()).find(n=>n.slug===r&&n.is_active);if(!i)throw new Error("Navigation tab not found");return i},staleTime:0,refetchOnWindowFocus:!1,refetchInterval:!1}),{data:d=[],isLoading:O,error:_}=P({queryKey:[`/api/products/page/${r}`,c],queryFn:async()=>{const s=`/api/products/page/${r}`,t=c&&c!=="all"?`${s}?gender=${encodeURIComponent(c)}`:s,i=await fetch(t);if(!i.ok){if(i.status===404)return[];throw new Error("Failed to fetch products")}return i.json()},enabled:!!r,staleTime:0}),E=(()=>{const s=new Set;return d.forEach(n=>{const g=D(n);g&&s.add(g)}),(s.has("boys")||s.has("girls"))&&!s.has("kids")&&s.add("kids"),["all",...["men","women","kids","boys","girls","unisex"].filter(n=>s.has(n))]})(),{data:U}=te((a==null?void 0:a.slug)||r||""),{data:B=[]}=P({queryKey:[`/api/categories/page/${r}`],queryFn:async()=>{const s=await fetch(`/api/categories/page/${r}`);if(!s.ok){if(s.status===404)return[];throw new Error("Failed to fetch categories")}return s.json()},enabled:!!r,staleTime:0}),I=o.useMemo(()=>{const s=Array.from(new Set((d||[]).map(i=>(i==null?void 0:i.category)??"").filter(Boolean))),t=new Set([...B,...s]);return Array.from(t)},[B,d]),A=((s,t)=>{if(!t||t==="all")return{min:0,max:1/0};if(/^\d+-\d+$/.test(t)){const[n,g]=t.split("-").map(x=>parseFloat(x));return{min:n,max:g}}const i=parseFloat(t);return{min:isNaN(i)?0:i,max:1/0}})(v,k),m=d.filter(s=>{if(h){const n=h.toLowerCase(),g=(s.category||"").toString().toLowerCase(),x=(s.subcategory||"").toString().toLowerCase();if(!({clothing:["clothing","apparel","fashion","garment","wear"]}[n]||[n]).some(q=>g.includes(q)||x.includes(q)))return!1}const t=parseFloat(String(s.price));if(t<A.min||t>A.max||parseFloat(String(s.rating||"0"))<w)return!1;if(c&&c!=="all"){const n=D(s);if(c==="kids"){if(!(n==="boy"||n==="girl"||n==="kids"))return!1}else if(n!==c)return!1}return!0}),G=s=>{N(s)};o.useEffect(()=>{const t=(new URLSearchParams(typeof window<"u"?window.location.search:"").get("gender")||"").toLowerCase();p((t==="common"?"unisex":t)||"all")},[r,z]);const T=s=>{const t=s==="common"?"unisex":s;p(t);const i=new URLSearchParams(typeof window<"u"?window.location.search:"");t==="all"?i.delete("gender"):i.set("gender",t);const n=typeof window<"u"?window.location.pathname:`/page/${encodeURIComponent(r||"")}`,g=i.toString(),x=g?`${n}?${g}`:n;typeof window<"u"&&window.history.replaceState(null,"",x)};if(o.useEffect(()=>{S&&f({title:"Page not found",description:"This navigation page does not exist or is not active.",variant:"destructive"})},[S,f]),o.useEffect(()=>{_&&f({title:"Error loading products",description:`Failed to load products for ${(a==null?void 0:a.name)||r}. Please try again.`,variant:"destructive"})},[_,f,a==null?void 0:a.name,r]),H)return e.jsx(X,{pageId:"dynamicpage",children:e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 page-container",children:[e.jsx(C,{}),e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2",children:"Loading page..."}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500",children:"Please wait while we load the page content."})]})}),e.jsx(F,{})]})});if(S||!a)return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 page-container",children:[e.jsx(C,{}),e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-6xl mb-4",children:e.jsx("i",{className:"fas fa-exclamation-triangle text-red-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2",children:"Page Not Found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500",children:"The page you're looking for doesn't exist or is not active."})]})}),e.jsx(F,{})]});const K={background:`linear-gradient(to right, ${a.color_from}, ${a.color_to})`};return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 page-container",children:[e.jsx(C,{}),e.jsx(l,{page:a.slug,position:"header-top",className:"w-full"}),e.jsx(Y,{}),e.jsxs("div",{className:"header-spacing",children:[e.jsx("div",{className:"py-8",style:K,children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-4",children:[e.jsx("i",{className:`${a.icon} mr-3`}),a.name]}),e.jsx("p",{className:"text-lg text-white/90 max-w-2xl mx-auto",children:a.description||`Discover amazing products in ${a.name}`}),e.jsx("div",{className:"mt-4",children:e.jsxs("span",{className:"inline-flex items-center px-4 py-2 bg-white/20 text-white rounded-full text-sm",children:[e.jsx("i",{className:"fas fa-box mr-2"}),m.length," Products Available"]})})]})})}),e.jsxs("div",{className:"md:hidden px-4 pt-3",children:[e.jsxs(Z,{onClick:()=>$(!0),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx("i",{className:"fas fa-sliders-h mr-2"})," Filters"]}),e.jsx(ie,{open:W,onOpenChange:$,children:e.jsxs(ne,{side:"left",className:"w-[85vw] sm:w-[22rem]",children:[e.jsx(re,{children:e.jsx(le,{children:"Filters"})}),e.jsx("div",{className:"mt-4",children:e.jsx(M,{showNetworks:!1,categorySelectionMode:"single",selectedCurrency:v,setSelectedCurrency:y,convertPrices:L,setConvertPrices:j,priceRange:k,setPriceRange:b,availableCategories:I,selectedCategory:h,setSelectedCategory:u,availableGenders:E,selectedGender:c,setSelectedGender:T,minRating:w,setMinRating:G,resultsCount:m.length,onClearFilters:()=>{u(""),y("all"),j(!1),b("all"),p("all"),N(0)}})})]})})]}),e.jsx(l,{page:a.slug,position:"header-bottom",className:"w-full"}),e.jsx(l,{page:a.slug,position:"banner-top",className:"w-full mb-4"}),e.jsxs("div",{className:"flex min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsx("div",{className:"hidden md:block",children:e.jsx(M,{showNetworks:!1,categorySelectionMode:"single",selectedCurrency:v,setSelectedCurrency:y,convertPrices:L,setConvertPrices:j,priceRange:k,setPriceRange:b,availableCategories:I,selectedCategory:h,setSelectedCategory:u,availableGenders:E,selectedGender:c,setSelectedGender:T,minRating:w,setMinRating:G,resultsCount:m.length,onClearFilters:()=>{u(""),y("all"),j(!1),b("all"),p("all"),N(0)}})}),e.jsx("div",{className:"hidden lg:block w-64 p-4",children:e.jsx(l,{page:a.slug,position:"sidebar-left"})}),e.jsxs("div",{className:"flex-1 p-6",children:[e.jsx("div",{className:"block md:hidden mb-4",children:e.jsx(l,{page:a.slug,position:"sidebar-right"})}),e.jsx(R,{page:a.slug,position:"body"}),!(U&&d.length===0)&&e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h2",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:["Results (",m.length,")"]}),e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",m.length," of ",d.length," products"]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{page:a.slug,position:"product-grid-top"}),O?e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsxs("h3",{className:"text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2",children:["Loading ",a.name,"..."]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500",children:"Finding the best products for you."})]}):m.length===0?U&&d.length===0?null:e.jsxs("div",{className:"text-center py-16",children:[e.jsx("div",{className:"text-6xl mb-4",children:e.jsx("i",{className:"fas fa-search text-gray-400"})}),e.jsx("h3",{className:"text-xl font-semibold text-gray-600 dark:text-gray-400 mb-2",children:d.length===0?`No ${a.name} available`:"No products found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500",children:d.length===0?`Products will appear here when added to ${a.name} via admin panel.`:"Try adjusting your filters to see more results."})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 sm:gap-4",children:m.map(s=>s.totalInGroup&&Number(s.totalInGroup)>1?e.jsx(ee,{product:s,source:r||"dynamic"},s.id):e.jsx(se,{product:{id:s.id,name:s.name,description:s.description||"",price:s.price,originalPrice:s.originalPrice||s.original_price,currency:s.currency||"INR",imageUrl:s.imageUrl||s.image_url,affiliateUrl:s.affiliateUrl||s.affiliate_url,category:s.category,rating:s.rating,reviewCount:s.reviewCount,discount:s.discount,isNew:s.isNew,isFeatured:s.isFeatured,affiliate_network:s.affiliate_network||s.networkBadge,networkBadge:s.networkBadge,affiliateNetwork:s.affiliateNetworkName||"Dynamic Network",sourceType:r||"dynamic",source:r||"dynamic",displayPages:[r||"dynamic"],priceDescription:s.priceDescription||s.price_description||"",monthlyPrice:s.monthlyPrice||s.monthly_price||0,yearlyPrice:s.yearlyPrice||s.yearly_price||0,pricingType:s.pricingType||s.pricing_type,isFree:s.isFree||s.is_free||!1,isService:s.isService||s.is_service||!1,isAIApp:s.isAIApp||s.is_ai_app||!1}},s.id))}),e.jsx(R,{page:a.slug,position:"product-grid-bottom"}),e.jsx(l,{page:a.slug,position:"content-top"}),e.jsx(l,{page:a.slug,position:"content-middle"}),e.jsx(l,{page:a.slug,position:"content-bottom"}),e.jsx(l,{page:a.slug,position:"floating-top-left"}),e.jsx(l,{page:a.slug,position:"floating-top-right"}),e.jsx(l,{page:a.slug,position:"floating-bottom-left"}),e.jsx(l,{page:a.slug,position:"floating-bottom-right"})]})]}),e.jsx("div",{className:"hidden xl:block w-80 p-4",children:e.jsx(l,{page:a.slug,position:"sidebar-right"})})]}),e.jsx(l,{page:a.slug,position:"banner-bottom",className:"w-full mt-6"}),a&&e.jsx(oe,{page:a.slug,title:`${a.name} Videos`})]}),e.jsx(l,{page:a.slug,position:"footer-top",className:"w-full"}),e.jsx(F,{}),e.jsx(l,{page:a.slug,position:"footer-bottom",className:"w-full"}),e.jsx(ae,{})]})}export{Ne as default};
